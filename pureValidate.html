<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="jQuery.js"> </script>
<script>
    $(document).ready(function () { 
        var pureValidate = function(conditions, formElement) {
        //variables taken via constructor
        this.conditions = conditions;
        this.formElement = formElement;
        this.definedConditions = new Array('empty','match');
        //setting variables up
        var form = this.formElement,
        inputs = form.getElementsByTagName('input'),
        isValid = true,
        Validator = this;

        this.conditionCheck = function conditionCheck(conditionOptions , input) {
            if (conditionOptions.hasOwnProperty('empty')) {
                if (input.value == "") {
                    return conditionOptions.empty;
                }
            }
            if (conditionOptions.hasOwnProperty('match')) {
                //get name of first key
                for (var key in conditionOptions.match)
                {   
                    if (conditionOptions.match.hasOwnProperty(key)) {
                        var matchKey = key;
                        var inputAgainst = document.getElementById(matchKey);
                    }
                }
                if (input.value != inputAgainst.value ) {
                    return conditionOptions.match[matchKey];
                }
            }
            if (conditionOptions.hasOwnProperty('regex')) {
                var match = conditionOptions.regex.match;
                var message = conditionOptions.regex.message;
                if (!match.test(input.value))
                {
                    return message;
                }
            }
        }

        this.getLabel = function getLabel(node) {
                    if (node.previousSibling.nodeType === 1 && node.previousSibling.tagName === "LABEL")
                        return node.previousSibling;
                    else 
                        var node = node.previousSibling;
                        return getLabel(node); 
                }
        
        this.resetMessage = function resetMessage(input) {
            var thisKey = input.getAttribute('id');
            var innerSpan = document.getElementById(thisKey + "_validate")
            if (innerSpan !== null) {
                innerSpan.innerHTML = '';
            }
        }

        this.validate = function validate() {
            for (var key in Validator.conditions) {
                if (Validator.conditions.hasOwnProperty(key)) {
                    var input = document.getElementById(key);
                    var conditionOptions = Validator.conditions[key];
                    var msgText = Validator.conditionCheck(conditionOptions,input);
                    var assocLabel = Validator.getLabel(input);
                    //here I am setting it so that it the text resets on change
                    input.onchange = function() {
                        Validator.resetMessage(this);
                    }
                    if (msgText !== undefined)
                    {
                        isValid = false;
                        var spanInner = document.createElement('span');
                        spanInner.setAttribute('id',key + "_validate");
                        var txtNode = document.createTextNode(" " + msgText);
                        spanInner.appendChild(txtNode);
                        var existingSpan = document.getElementById(key + "_validate");
                        /* Only append span if it doesn't exist*/
                        if (existingSpan === null) {
                        assocLabel.appendChild(spanInner);
                        }
                        else {
                            /* if it does exist check to see if message needs to be changed or not*/
                            if (existingSpan.innerHTML !== " " + msgText) {
                                existingSpan.innerHTML = " " + msgText;
                            } 
                        }
                    }
                }
            }
        }
        /* Find the submit button*/
        for (var i=0; i < inputs.length; i++) {
            if (inputs[i].getAttribute('type') === 'submit' || inputs[i].getAttribute('type') === 'button') {
                /* Handle submit buttons and resetting on change here*/
                inputs[i].onclick = function() {
                   Validator.validate();
                };
            }
        }

    }
    
});
</script>
<script>
$(document).ready(function() {
    var userConditions = {
        user_username: { 
            empty: "Please provide a username"
        },
        user_password: { 
            empty: "Please provide a password"
        },
        user_email: { 
            empty: "Please provide an email",
            regex: {
                match: /^([\w-\'\+]+(?:\.[\w-\'\+]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,
                message: "Please provide a valid email"
            }
        },
       user_confirmEmail: {
            empty: "Please confirm your email",
            match: {
                user_email:"Please make sure emails are identical"
            }
        }
    };
    var newUserForm = document.getElementById('new-user-form');
    var userForm = new pureValidate(userConditions, newUserForm);
});
</script>
</head>
<body>
<form accept-charset="UTF-8" class="new_user" data-remote="true" id="new-user-form" method="post">
	<div class="input-text">
		<label for="username">Username </label>
		<input id="user_username" name="user[username]" type="text" />
	</div>
	<div class="input-text">
		<label for="password">Password</label>
		<input id="user_password" name="user[password]" type="password" />
	</div>
	<div class="input-text">
		<label for="email">Email</label>
		<input id="user_email" name="user[email]" type="email" />
	</div>
	<div class="input-text">
		<label for="confirmEmail">Confirm Email</label>
		<input id="user_confirmEmail"  type="email" />
	</div>
    <label for="ding-dong"> Ding Dong </label>
	<input class="form-submit" name="commit" type="button" value="CREATE USER" />
</form>

<div id="debug"> </div>

</body>
</html>